<!DOCTYPE html>
<html>

<body>
<h1>Lights Out!</h1>

<table id="board">
  <tr>
    <td class="cell" id="cell-0-0"></td>
    <td class="cell" id="cell-0-1"></td>
    <td class="cell" id="cell-0-2"></td>
    <td class="cell" id="cell-0-3"></td>
    <td class="cell" id="cell-0-4"></td>
    <td class="cell" id="cell-0-5"></td>
    <td class="cell" id="cell-0-6"></td>
  </tr>
  <tr>
    <td class="cell" id="cell-1-0"></td>
    <td class="cell" id="cell-1-1"></td>
    <td class="cell" id="cell-1-2"></td>
    <td class="cell" id="cell-1-3"></td>
    <td class="cell" id="cell-1-4"></td>
    <td class="cell" id="cell-1-5"></td>
    <td class="cell" id="cell-1-6"></td>
  </tr>
  <tr>
    <td class="cell" id="cell-2-0"></td>
    <td class="cell" id="cell-2-1"></td>
    <td class="cell" id="cell-2-2"></td>
    <td class="cell" id="cell-2-3"></td>
    <td class="cell" id="cell-2-4"></td>
    <td class="cell" id="cell-2-5"></td>
    <td class="cell" id="cell-2-6"></td>
  </tr>
  <tr>
    <td class="cell" id="cell-3-0"></td>
    <td class="cell" id="cell-3-1"></td>
    <td class="cell" id="cell-3-2"></td>
    <td class="cell" id="cell-3-3"></td>
    <td class="cell" id="cell-3-4"></td>
    <td class="cell" id="cell-3-5"></td>
    <td class="cell" id="cell-3-6"></td>
  </tr>
  <tr>
    <td class="cell" id="cell-4-0"></td>
    <td class="cell" id="cell-4-1"></td>
    <td class="cell" id="cell-4-2"></td>
    <td class="cell" id="cell-4-3"></td>
    <td class="cell" id="cell-4-4"></td>
    <td class="cell" id="cell-4-5"></td>
    <td class="cell" id="cell-4-6"></td>
  </tr>
</table>

</body>
</html>

#board {
  border: 1px black solid;
}

.cell {
  background-color: navy;
  width: 50px;
  height: 50px;
}

.cell.on {
  background-color: tomato;
}


const WIDTH = 7;
const HEIGHT = 5;
const DIFFICULTY = 3;


// Pick a random number 1 to max

function randomNumber(max) {
  return Math.floor(Math.random() * max) + 1; 
}


// Toggle a single cell on <-> off

function toggleCell(y, x) {
  if (x >= 0 && x < WIDTH && y >= 0 && y < HEIGHT) {
    let id = "#cell-" + y + "-" + x;
    let cell = document.querySelector(id);
    cell.classList.toggle("on");
  }
}


// Look at all cells to see if won -- returns true/false

function checkForWin() {
  for (let cell of document.querySelectorAll(".cell")) {
    if (cell.classList.contains("on")) {
      return false;
    }
  }

  return true;
}


// toggle this cell and top/left/right/bottom neighbors

function toggleCellAndNeighbors(y, x) {
  toggleCell(y - 1, x);
  toggleCell(y, x - 1);
  toggleCell(y, x);
  toggleCell(y, x + 1);
  toggleCell(y + 1, x);
}


// pop up a winning message & reset

function handleWin() {
  alert("Great job!");
  setupRandomBoard();
}


// handle player clicking on cell:
//
// - find out where they clicked
// - toggle that cell and its neighbors
// - if they won, pop up winning message

function handleCellClick(event) {
  let id = event.target.id;
  let y = Number(id[5]);
  let x = Number(id[7]);
  console.log("clicked on", x, y);

  toggleCellAndNeighbors(y, x);

  if (checkForWin()) {
    setTimeout(handleWin, 500); // 500ms = 1/2sec
  }
}


// Setup random board

function setupRandomBoard() {
  for (let i = 0; i < DIFFICULTY; i++) {
    let x = randomNumber(WIDTH) - 1;
    let y = randomNumber(HEIGHT) - 1;
    toggleCellAndNeighbors(y, x);
  }
}


// Add "click listener" to each cell

function addClickListeners() {
  for (let cell of document.querySelectorAll(".cell")) {
    cell.addEventListener("click", handleCellClick)
  }
}


// Code that runs when page first loads:

setupRandomBoard();
addClickListeners();